MySQL的MVCC（Multi-Version Concurrency Control）是一种并发控制机制，它用于保证并发事务之间的隔离性，避免数据不一致的情况。

MVCC基于以下几个关键概念：

1. 版本号：每次对数据进行修改时，系统会为其创建一个新的版本，每个版本都有一个唯一的版本号。

2. 事务开始时间和结束时间：在MVCC中，每个事务都有一个开始时间和结束时间。开始时间是事务第一次读取数据的时间，结束时间是事务提交的时间或者回滚的时间，min_trx_id,max_trx_Id: 活跃的最小事务id和下次开启事务的id。。

3. creator_trx_id：当前事务id，只有在写操作时会生成。START TRANSACTION READ ONLY只读事务，START TRANSACTION READ WRITE，BEGIN、START TRANSACTION都是读写事务

   

4. 快照：每个事务在开始时会创建一个快照，用于记录当前的数据库状态。快照包含了当前所有的数据版本号以及事务开始时间和结束时间。

5. 可见性规则：根据事务开始时间和结束时间以及每个数据版本号的创建时间，系统可以确定哪些数据版本对于当前事务是可见的。

在MVCC中，每个事务都可以读取数据库的一个快照，而不会受到其他事务的干扰。当一个事务要对数据进行修改时，系统会为其创建一个新的版本，并且更新数据的版本号。如果其他事务在此之前已经读取了旧版本的数据，则它们不会看到新版本的数据。

如果两个事务同时修改了同一条数据，系统会根据版本号以及事务开始时间和结束时间来判断哪个事务的修改应该被保留。这个过程是通过数据库的锁机制来实现的，如果两个事务同时请求修改同一条数据，则只有一个事务能够成功，另一个事务则需要等待或者回滚。

MVCC可以提高数据库的并发性能，因为它允许多个事务同时读取数据库的快照，而不会相互干扰。同时，MVCC还可以减少锁的使用，从而避免了锁竞争可能带来的性能问题。



判断readview在可重复读中，在一个事物中进行读操作后再写操作，是否是重新生成readview，还是更新creator_trx_id。

commit表示事物执行完毕，commit后重新分配trx_id

> 开启事务A和事务B
>
> | 事务A                                                        | 事务B                                                  | 事务B‘（事务B在commit后，trx_Id改变）                  |
> | ------------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------ |
> |                                                              | START TRANSACTION;                                     |                                                        |
> |                                                              | update tb_usap_user set xm  = '001' where user_id = 1; |                                                        |
> |                                                              | commit;                                                |                                                        |
> | START TRANSACTION;                                           |                                                        |                                                        |
> | select xm  from tb_usap_user where user_id = 1;              |                                                        |                                                        |
> |                                                              |                                                        | update tb_usap_user set xm  = '002' where user_id = 1; |
> |                                                              |                                                        | commit;                                                |
> | select xm from tb_usap_user where user_id = 1;(此时查询结果xm=001) |                                                        |                                                        |
> | update tb_usap_user set xm  = '003' where user_id = 2;       |                                                        |                                                        |